#!/bin/sh

# READY

pkg install -y nginx

if [ ! -e /usr/local/etc/nginx/nginx.conf-dist ]; then
    echo "ERROR: install failed"
    exit 1
fi

nginx-config-sites-enabled
nginx-openssl-generate

sysrc nginx_enable="YES"

cat ~/git/deploy/usr/local/etc/nginx/sites-available/zfssyncstatus \
| sed "s/localhost.my.domain/${FQDN}/" \
>/usr/local/etc/nginx/sites-enabled/zfssyncstatus

rsync -virtP ~/git/deploy/usr/local/www/zfssyncstatus/  /usr/local/www/zfssyncstatus/

find /usr/local/www/zfssyncstatus -exec chown root:wheel {} \;
find /usr/local/www/zfssyncstatus -type d -exec chmod 755 {} \;
find /usr/local/www/zfssyncstatus -type f -exec chmod 644 {} \;



service nginx start
