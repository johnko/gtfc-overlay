#!/bin/sh

BLACKLIST=$( pf-table show black | tr '\n' '|' | tr -d ' ' )
if [ "x${BLACKLIST}" = "x" ]; then
	BLACKLIST="randomstringofdatahere"
fi

if ls /var/log/auth.log*bz2 >/dev/null 2>&1 ; then
  bunzip2 /var/log/auth.log*bz2
fi

MYNIC=`net-nic`

cat /var/log/auth.log* \
| sed "s/ `net-ip $MYNIC` / /g" \
| sed "s/ ${REMOTEHOST} / /g" \
| fold -w 150 \
| grep -B1 "no matching mac found" \
| egrep "(Connection from|no matching mac found)" \
| egrep -v "(${BLACKLIST%|})"
